
<a name="readme-top"></a>

<h1 align="center">FAN ATPG</h1>
<div align="center"><small><i>version 2023<br>
Laboratory of Dependable Systems, Graduate Institute of Electronics Engineering,  National Taiwan University, Taiwan</small></i></div>
<br><br>
<div align="center">
  <p><b>FAN (fan-out-oriented) ATPG (Automatic Test Pattern Generation) and Fault Simulation command line tool</b></p>
  <p>
    <a href="https://youtu.be/YVTEh4qM6yE">
    <strong>Youtube Tutorial »</strong></a>
  </p>
  <p>
    <a href="https://github.com/NTU-LaDS-II/FAN_ATPG/blob/main/ATPG_UserGuide.pdf">
    <strong>User Guide »</strong></a>
  </p>
  <p>This tool's main algorithm is implemented based on the following paper: <br>
  <i>Fujiwara and Shimono, "On the Acceleration of Test Generation Algorithms," in IEEE Transactions on Computers, vol. C-32, no. 12, pp. 1137-1144, Dec. 1983.</i></p>
</div>

## Table Contents
<ol>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#directory-structure">Directory Structure</a></li>
  <li><a href="#environment-requisites">Environment Requisites</a></li>
  <li><a href="#usage">Usage</a></li>
  <li><a href="#experimental-result">Experimental Result</a></li>
  <li><a href="#revision-history">Revision History</a></li>
  <li><a href="#authors">Authors</a></li>
  <li><a href="#references">References</a></li>
  <li><a href="#contact">Contact</a></li>
  <li><a href="#license">License</a></li>
</ol>

## Introduction

This project is a FAN (fan-out-oriented)[1] ATPG (Automatic Test Pattern Generation) and Fault Simulation command line tool.

This project includes the implementation of 
1. Fault Collapsing
2. Parallel Fault Fault Simulation
3. Parallel Pattern Fault Simulation 
4. Automatic Test Pattern Generation
5. Static Test Compression
6. Dynamic Test Compression
7. Writing pattern in different format:<br>
  \- `STIL` : Support Fault Simulation with the commercial tool `TetraMAX` <br>
  \- `ASCII` : Support Fault Simulation with the commercial tool `FastScan` <br>
  \- `.pat` : Support Fault Simulation with this tool `FAN_ATPG`
8. Multiple Fault Orderings <br> ***Note: This feature is now moved to branch `MFO`, should be integrated as an additional command line opption in the future.***<br>
  This is a heuristic we implemented in v2023. It tries a rational number of fault list orderings that differ to one another as much as possible with rational run time. With different fault list orderings, we choose the fault list ordering that generate test pattern set with the highest Fault Coverage and the lowest Test Length (if same Fault Coverage).<br>

We make this project open source in the hope of helping anyone who is learning ATPG. If you have any suggestion for the source code or new features for this project, feel free to fork this repo and create a pull request. Any contribution to this project would be very much appreciated!

We would also be extremely grateful if you star this project!

<p align="right">[<a href="#readme-top">back to top</a>]</p>

## Directory Structure

- `bin/` : Binary - Store binaries after compilation
- `include/` : Store header files included in and copied from `pkg/` 
- `lib/` : Library - Store library binaries after compilation
- `mod_netlist/`, `netlist/` : Store the benchmark circuits[2]
- `pat/` : Patterns - Store the patterns generated by ATPG
- `pkg/` : Package - All of the source code
  - `common/` : Common Linux command line instructions support
  - `core/` : Main ATPG algorithm and the Fault Simulation procedure 
  - `fan/` : The ATPG commands and entry point of the program
  - `interface/` : The interface for reading benchmark circuits 
- `rpt/` : Report - Store the report after ATPG or Fault Simulation 
- `script/` : Scripts for running ATPG and Fault Simulation 
- `techlib/` : The cell libraries for benchmark circuits
- `utility/` : The utilities files, e.g. convert `STIL` to `.pat`
- `ATPG_UserGuide.pdf` : The User Guide
- `copyHeader.sh` : Copy header files from `pkg/` to `include/`
- `Makefile` : The top makefile for the whole project
- `common.mk` : Define the project layout for `Makefile`, e.g. directory structure, C++ version, Lex&Yacc.
- `info.mk` : Define package name, type and dependency, e.g. `fan`, `libcommon.a`
- `rule.mk` : Define rules for make targets, which folder the binary should be generated or copied to.

<p align="right">[<a href="#readme-top">back to top</a>]</p>


## Environment Requisites

### Prerequisites

- Operating System : *Linux*<br>
- Compiler : *Support std C++11*<br>
- Other tools : *Bison, Lex*<br>

### Requisites Installation
```sh
sudo apt install bison
sudo apt install flex
```
### Check requisites Installation
```sh
bison --version
lex --version
```
<p align="right">[<a href="#readme-top">back to top</a>]</p>

## Usage

### Installation
After the following commands are executed, an executable binary `fan` will be generated under `./bin/opt/`.

1. Clone the repo
    ```sh
    git clone https://github.com/NTU-LaDS-II/FAN_ATPG.git
    ```
2. Change directory
    ```sh
    cd FAN_ATPG/
    ```
3. Compile
    ```sh
    make
    ```

### Clean Installed Files

```sh
make clean
```

### Run ATPG

```sh
./bin/opt/fan -f script/fanScripts/atpg_s27.script
```

### Run Fault Simulation

```sh
./bin/opt/fan -f script/fanScripts/fsim_s27.script
```

<p align="right">[<a href="#readme-top">back to top</a>]</p>

## Experimental Result

- Fault Coverage (FC) \- <br>
Fault Coverage is the most important statistic for evaluation of an ATPG tool. It indicates how well a circuit could be tested, hence the quality of a test pattern set. The calculation equation by this tool `FAN_ATPG` is as follow:
  ```math
  FC = {number \ of \ \textbf{\textit{detected}} \ faults \over number \ of \ \textbf{\textit{total}} \ faults} \ * \ 100\%
  ```

- Test Length (TL) \- <br>
Under the same Fault Coverage, it is essential to compress the Test Length. The definition of Test Length is the ***total number of test patterns*** in a test pattern set. Low Test Length is desired in order to reduce test data (ATE cost), test time (test cost) while maintaining the same test quality (FC).

### Both Test Compression **OFF**

  | Benchmark Circuit  | Fault Coverage (%) | Test Length (#) |
  | :----: | :----: | :----: |
  | s27    | 94.55  | 12     |
  | s208   | 97.43  | 46     |
  | s510   | 99.14  | 70     |
  | s953   | 97.85  | 123    |
  | s1196  | 98.84  | 183    |
  | s1238  | 96.36  | 193    |
  | s5378  | 96.04  | 478    |
  | s9234  | 94.14  | 647    |
  | s15850 | 94.62  | 817    |
  | s35932 | 87.58  | 1764   |
  | s38417 | 95.99  | 2428   |
  | s38584 | 93.33  | 1832   |
<br>

### Static Test Compression **On** Dynamic Test Compression **OFF**

  | Benchmark Circuit  | Fault Coverage (%) | Test Length (#) |
  | :----: | :----: | :----: |
  | s27    | 94.55  | 9      |
  | s208   | 97.43  | 36     |
  | s510   | 99.14  | 65     |
  | s953   | 97.85  | 93     |
  | s1196  | 98.84  | 155    |
  | s1238  | 96.36  | 163    |
  | s5378  | 96.04  | 327    |
  | s9234  | 94.14  | 475    |
  | s15850 | 94.62  | 583    |
  | s35932 | 87.58  | 512    |
  | s38417 | 95.99  | 1565   |
  | s38584 | 93.33  | 1177   |
<br>

### Static & Dynamic Test Compression **ON**

  | Benchmark Circuit  | Fault Coverage (%) | Test Length (#) |
  | :----: | :----: | :----: |
  | s27    | 94.55  | 5      |
  | s208   | 97.43  | 29     |
  | s510   | 99.14  | 59     |
  | s953   | 97.85  | 89     |
  | s1196  | 98.84  | 134    |
  | s1238  | 96.36  | 145    |
  | s5378  | 96.04  | 117    |
  | s9234  | 94.14  | 156    |
  | s15850 | 94.62  | 133    |
  | s35932 | 87.58  | 21     |
  | s38417 | 96.00  | 105    |
  | s38584 | 93.33  | 133    |

<p align="right">[<a href="#readme-top">back to top</a>]</p>

## Revision History

- v2013 - Initial release<br>
- v2014 - Code modifications<br>
- v2023 - Code refactor for open source project<br>

<p align="right">[<a href="#readme-top">back to top</a>]</p>

## Authors
- Lead Author<br>
  \- **Lin Hio-Ting**<br>
  <br>
- Original Authors<br>
  \- **Lin Hio-Ting**, Hsu Po-Ya, Liao Kuan-Yu<br>
  <br>
- v2013<br>
  \- Han Cheng-You, Chen Ching-Yu, Chiang Kuan-Ying, Wang Ying-Hsu, Chen Po-Hao, Lin Kuo-Yu, Pan Chun-Han, Li Chia-An, Tsai Chia-Ling, Hsu Ling-Yun<br>
  <br>
- v2014<br>
  \- He Yu-Hao, Cai Zong-Yan, How Bo-Fan, Li Yu-Qing, Huang Guan-Yan, Xiao Zhi-Long, Lin Kun-Wei, Lin Shi-Yao, Chen You-Wei, Li Guan-De<br>
  <br>
- v2023<br>
  \- Wang Wei-Shen, Chang Hsin-Tzu, Pan Yu-Hung, Liang Zhe-Jia<br>
  <br>
- Advisor<br>
  \- **Professor James Chien-Mo Li**

<p align="right">[<a href="#readme-top">back to top</a>]</p>

## References

- [1] *Fujiwara and Shimono, "On the Acceleration of Test Generation Algorithms," in IEEE Transactions on Computers, vol. C-32, no. 12, pp. 1137-1144, Dec. 1983.*<br>
- [2] *Brglez, Franc, David Bryan, and Krzysztof Kozminski. "Combinational profiles of sequential benchmark circuits." 1989 IEEE International Symposium on Circuits and Systems (ISCAS). IEEE, 1989.*<br>
- [3] `techlib/mod_nangate45.mdt` and `techlib/NangateOpenCellLibrary.v` are under `TECHLIB_LICENSE`<br>

<p align="right">[<a href="#readme-top">back to top</a>]</p>

## Contact
Wang Wei-Shen - b08901051@ntu.edu.tw

<p align="right">[<a href="#readme-top">back to top</a>]</p>

## License
Distributed under the MIT License. See `LICENSE` for more information.<br>
<p align="right">[<a href="#readme-top">back to top</a>]</p>
<hr>

<small><i>Copyright (c) Laboratory of Dependable Systems, Graduate Institute of Electronics Engineering,  National Taiwan University, Taiwan. All Rights Reserved.</i></small>
